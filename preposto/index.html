<!DOCTYPE html>

<html lang="it">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Area Preposto ‚Äì Gestore dei Trasporti</title>
<link href="../stile.css" rel="stylesheet"/>
<style>
    /* Estensioni leggere senza toccare stile.css */
    .note { max-width: 800px; margin: 10px auto; background:#fff; padding:12px 14px; border-radius:6px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #007bff; color:#0056b3; background:#f0f8ff; margin:4px 6px 0 0; font-size:0.9rem; }
    .actions { max-width:800px; margin: 10px auto 30px auto; display:flex; gap:10px; flex-wrap: wrap; justify-content:center; }
    button {
      border:1px solid #007bff; background:#007bff; color:#fff;
      padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:bold;
    }
    button.secondary { background:#fff; color:#007bff; }
    button:active { transform: translateY(1px); }

    /* Registro controlli: layout moderno (desktop = griglia, mobile = card) */
    .registro-wrap{
      max-width: 900px;
      margin: 0 auto;
      background:#fff;
      border-radius:10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      border:1px solid #cfe2ff;
      overflow:hidden;
    }
    .registro-header{
      display:grid;
      grid-template-columns: 140px 180px 1.2fr 140px 1.6fr 96px;
      gap:0;
      padding:10px;
      background:#f0f8ff;
      color:#0056b3;
      font-weight:bold;
      border-bottom:1px solid #cfe2ff;
    }
    .registro-rows{
      display:block;
    }
    .registro-row{
      display:grid;
      grid-template-columns: 140px 180px 1.2fr 140px 1.6fr 96px;
      gap:0;
      padding:10px;
      border-bottom:1px solid #e6f0ff;
      align-items:start;
    }
    .registro-row:nth-child(even){ background:#fbfdff; }
    .registro-row:last-child{ border-bottom:none; }
    .field{ padding:4px; }
    .field[data-label]::before{
      content: "";
      display:none;
    }
    .cell-actions{ text-align:center; }

    /* Badge esito (pi√π leggibile) */
    select.esito.ok{ border-color:#b7ebc6; background:#f2fbf5; }
    select.esito.warn{ border-color:#ffd7a8; background:#fff7ed; }
    select.esito.ko{ border-color:#ffb4b4; background:#fff1f1; }

    @media (max-width: 920px){
      .registro-header{ display:none; }
      .registro-row{
        grid-template-columns: 1fr;
        padding:12px;
      }
      .field{ padding:6px 4px; }
      .field[data-label]::before{
        content: attr(data-label);
        display:block;
        font-size:0.82rem;
        color:#2c3e50;
        margin:0 0 6px 2px;
        font-weight:bold;
      }
      .cell-actions{ text-align:left; }
    }
    .btn-mini{
      border:1px solid #007bff;
      background:#fff;
      color:#007bff;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
      font-size:0.9rem;
    }
    input[type="text"], input[type="date"], select, textarea {
      width:100%;
      padding:8px;
      border:1px solid #cfe2ff;
      border-radius:6px;
      box-sizing:border-box;
      background:#fff;
      font-size:0.95rem;
    }
    textarea { min-height: 70px; resize: vertical; line-height:1.35; }
    .muted { color:#555; font-size:0.92rem; }
    .ok { color:#1a7f37; font-weight:bold; }
    .warn { color:#b54708; font-weight:bold; }

    @media print {
      nav, .home-button, .actions, .print-hide { display:none !important; }
      body { margin: 10mm; background:#fff; }
      li { box-shadow:none; }
      .note { box-shadow:none; border:1px solid #ddd; }
      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
      /* Stampa selettiva: mostra solo una sezione (checklist o ispezione) */
      body[data-print] .section,
      body[data-print] .note { display:none !important; }

      body[data-print="checklist"] #checklist { display:block !important; }
      body[data-print="ispezione"] #ispezione { display:block !important; }
      body[data-print="registro"] #registro { display:block !important; }

      /* ...e in stampa selettiva, mostra anche le note interne alla sezione scelta (es. tabella registro) */
      body[data-print="checklist"] #checklist .note,
      body[data-print="ispezione"] #ispezione .note,
      body[data-print="registro"] #registro .note { display:block !important; }

      /* Registro: stampa pulita (con intestazioni) */
      .registro-wrap{ box-shadow:none; border-color:#ddd; }
      .registro-header{ display:grid !important; }
      .cell-actions{ display:none !important; }
      textarea{ min-height: 50px; }

      /* In stampa selettiva mantieni il titolo */
      body[data-print] h1 { display:block !important; }

    }
  </style>
</head>
<body><nav class="top-nav"><a href="../index.html">üè† Home</a><a href="../finanziaria/index.html">üí∞ Finanziaria</a><a href="../dieta/index.html">ü•ó Dieta</a><a href="../task/index.html">‚úÖ Task</a><a href="../forza/index.html">üí™ Forza</a><a href="../preposto/index.html">üöõ Preposto</a></nav><div class="breadcrumb"><a href="../index.html">Home</a><span class="sep">‚Ä∫</span><span>Preposto</span></div>
<div class="home-button">
<a href="../index.html">üè† Torna alla Home</a>
</div>
<h1>Area Preposto ‚Äì Gestore dei Trasporti</h1>
<nav>
<a href="#normativa">Normativa</a>
<a href="#ruolo">Ruolo</a>
<a href="#checklist">Checklist</a>
<a href="#registro">Registro Controlli</a>
<a href="#ispezione">Ispezione</a>
</nav>
<div class="note">
<span class="pill">Operativit√†</span>
<span class="pill">Conformit√†</span>
<span class="pill">Pronto-controllo</span>
<p class="muted">
      Opinione: la miglior difesa, nei controlli, √® poter dimostrare <strong>metodo</strong> e <strong>continuit√†</strong>.
      Questa pagina ti aiuta a farlo in modo semplice.
    </p>
</div>
<div class="section" id="normativa">
<h2>1. Normativa di riferimento</h2>
<ul>
<li><strong>Regolamento (CE) n. 1071/2009</strong> ‚Äì Accesso alla professione di trasportatore su strada (requisiti e ruolo del gestore)</li>
<li>D.Lgs. 395/2000 e normativa nazionale di attuazione</li>
<li>Codice della Strada e disposizioni su pesi/dimensioni, dispositivi, documenti di bordo</li>
<li>Normativa sociale: tempi di guida e riposo, tachigrafo</li>
<li>Sicurezza sul lavoro e formazione (DVR, procedure, istruzioni)</li>
</ul>
</div>
<div class="section" id="ruolo">
<h2>2. Ruolo e responsabilit√† del Preposto / Gestore</h2>
<ul>
<li>Gestione <strong>effettiva e continuativa</strong> dell‚Äôattivit√† di trasporto</li>
<li>Organizzazione dei turni e prevenzione infrazioni</li>
<li>Controllo veicoli, manutenzione, idoneit√† e documenti</li>
<li>Controllo tachigrafo e tempi guida/riposo</li>
<li>Istruzione e supervisione degli autisti (procedure operative)</li>
<li>Gestione evidenze: registri, checklist, archivi (ci√≤ che ‚Äúprova‚Äù il lavoro)</li>
</ul>
</div>
<div class="section" id="checklist">
<h2>3. Checklist attivit√† (stampabile)</h2>
<p class="muted">Suggerimento pratico: compila e poi usa <strong>Stampa/Salva PDF</strong> per archiviare.</p>
<h3>Giornaliere</h3>
<ul>
<li><label><input class="ck" type="checkbox"/> Verifica disponibilit√† documenti di bordo (carta circolazione, assicurazione, licenze)</label></li>
<li><label><input class="ck" type="checkbox"/> Controllo idoneit√† autista (patente/CQC valide, tesserini, eventuali limitazioni)</label></li>
<li><label><input class="ck" type="checkbox"/> Verifica uso corretto tachigrafo (carta inserita, modalit√† corretta, assenza manomissioni evidenti)</label></li>
<li><label><input class="ck" type="checkbox"/> Check rapido veicolo (luci, gomme, segnalazioni, eventuali anomalie)</label></li>
</ul>
<h3>Settimanali</h3>
<ul>
<li><label><input class="ck" type="checkbox"/> Scarico/controllo dati tachigrafo (autista/veicolo) e verifica anomalie</label></li>
<li><label><input class="ck" type="checkbox"/> Verifica tempi guida/riposo e gestione eventuali infrazioni (correzioni organizzative)</label></li>
<li><label><input class="ck" type="checkbox"/> Verifica scadenze prossime (revisioni, assicurazioni, CQC, visite mediche)</label></li>
</ul>
<h3>Mensili</h3>
<ul>
<li><label><input class="ck" type="checkbox"/> Piano manutenzione: controlli eseguiti e interventi programmati</label></li>
<li><label><input class="ck" type="checkbox"/> Riunione/briefing con autisti (sicurezza, procedure, errori ricorrenti)</label></li>
<li><label><input class="ck" type="checkbox"/> Audit documentale: archivi tachigrafici, contratti, incarichi, deleghe, procedure</label></li>
</ul>
<div class="actions">
<button class="secondary" onclick="printOnly('checklist')">üñ®Ô∏è Stampa solo Checklist</button>
<button class="secondary" onclick="window.print()">üñ®Ô∏è Stampa pagina intera</button>
<button class="secondary" onclick="resetChecklist()">üîÑ Azzera checklist</button>
</div>
</div>
<div class="section" id="registro">
<h2>4. Registro controlli interno (salva nel browser)</h2>
<p class="muted">Questo registro crea ‚Äútraccia‚Äù del lavoro del preposto. √à una delle cose pi√π utili in caso di ispezione.</p>
<div class="actions print-hide">
<button onclick="addRow()">‚ûï Aggiungi riga</button>
<button class="secondary" onclick="saveRegistro()">üíæ Salva</button>
<button class="secondary" onclick="loadRegistro()">üìÇ Carica</button>
<button class="secondary" onclick="exportJSON()">‚¨áÔ∏è Export JSON</button>
<button class="secondary" onclick="printOnly('registro')">üñ®Ô∏è Stampa solo Registro</button>
<button class="secondary" onclick="window.print()">üñ®Ô∏è Stampa / Salva PDF</button>
<button class="secondary" onclick="clearRegistro()">üóëÔ∏è Svuota</button>
</div>
<div class="note">
<div class="muted"><strong>Nota:</strong> il salvataggio √® in <em>localStorage</em> (solo su questo dispositivo/browser).</div>
</div>
<div class="registro-wrap">
<div class="registro-header">
<div>Data</div>
<div>Area</div>
<div>Attivit√† / Controllo</div>
<div>Esito</div>
<div>Azioni correttive / Note</div>
<div class="cell-actions">Azioni</div>
</div>
<div class="registro-rows" id="registroRows"></div>
</div>
</div>
<div class="section" id="ispezione">
<h2>5. Gestione ispezioni (procedura rapida)</h2>
<h3>Prima cosa: ordine e calma</h3>
<ul>
<li>Identifica l‚Äôorgano di controllo e richiedi indicazioni su cosa stanno verificando</li>
<li>Evita discussioni: fornisci documenti e rispondi in modo semplice e coerente</li>
<li>Annota ora, luogo, nominativi (se disponibili) e oggetto del controllo</li>
</ul>
<h3>Cartella ‚Äúpronta-controllo‚Äù (consigliata)</h3>
<ul>
<li>Licenza comunitaria / autorizzazioni e copia conforme (se applicabile)</li>
<li>Contratto/nomina del gestore (e prova del ruolo effettivo)</li>
<li>Elenco veicoli, scadenze, manutenzioni, revisioni</li>
<li>Archivio tachigrafico (scarichi, controlli, report e gestione anomalie)</li>
<li>Procedure interne (guida/riposo, uso tachigrafo, sicurezza, istruzioni autisti)</li>
<li>Registro controlli (questa pagina) + eventuali checklist stampate</li>
</ul>
<h3>Cosa dimostrare (in sostanza)</h3>
<ul>
<li><strong>Presenza e continuit√†</strong> del gestore (non ‚Äúsolo sulla carta‚Äù)</li>
<li><strong>Prevenzione</strong>: controlli effettuati prima che succedano problemi</li>
<li><strong>Correzione</strong>: quando emerge un‚Äôanomalia, l‚Äôazione correttiva √® registrata</li>
</ul>
<div class="actions">
<button class="secondary" onclick="printOnly('ispezione')">üñ®Ô∏è Stampa solo Ispezione</button>
<button class="secondary" onclick="window.print()">üñ®Ô∏è Stampa pagina intera</button>
</div>
<div class="note">
<p class="muted">
        Opinione: se hai <strong>registro + evidenze</strong>, la conversazione con l‚Äôispettore cambia completamente.
        Senza evidenze, anche l‚Äôazienda pi√π seria fa fatica a ‚Äúprovarlo‚Äù.
      </p>
</div>
</div>
<script>
  // --- Stampa selettiva (solo una sezione) ---
  function printOnly(sectionId){
    document.body.setAttribute("data-print", sectionId);
    window.print();
  }
  window.addEventListener("afterprint", () => {
    document.body.removeAttribute("data-print");
  });

  // --- Checklist (persistenza semplice) ---
  const CK_KEY = "preposto_checklist_v1";
  function saveChecklist(){
    const states = Array.from(document.querySelectorAll(".ck")).map(c => c.checked);
    localStorage.setItem(CK_KEY, JSON.stringify(states));
  }
  function loadChecklist(){
    try{
      const raw = localStorage.getItem(CK_KEY);
      if(!raw) return;
      const states = JSON.parse(raw);
      document.querySelectorAll(".ck").forEach((c,i)=> c.checked = !!states[i]);
    }catch(e){}
  }
  function resetChecklist(){
    document.querySelectorAll(".ck").forEach(c => c.checked = false);
    saveChecklist();
  }
  document.addEventListener("change", (e)=>{
    if(e.target.classList && e.target.classList.contains("ck")) saveChecklist();
    if(e.target.classList && e.target.classList.contains("esito")) syncEsitoClasses();
  });

  // --- Registro controlli ---
  const REG_KEY = "preposto_registro_v1";

  function rowTemplate(data){
    const d = data || {date:"", area:"Tachigrafo", attivita:"", esito:"OK", note:""};
    return `
      <div class="registro-row">
        <div class="field" data-label="Data">
          <input type="date" value="${escapeHtml(d.date)}">
        </div>
        <div class="field" data-label="Area">
          <select class="area">
            ${option("Tachigrafo", d.area)}
            ${option("Guida/Riposo", d.area)}
            ${option("Veicoli/Manutenzione", d.area)}
            ${option("Documenti", d.area)}
            ${option("Autisti/Formazione", d.area)}
            ${option("Sicurezza", d.area)}
            ${option("Altro", d.area)}
          </select>
        </div>
        <div class="field" data-label="Attivit√† / Controllo">
          <textarea placeholder="Descrivi controllo/attivit√†...">${escapeHtml(d.attivita)}</textarea>
        </div>
        <div class="field" data-label="Esito">
          <select class="esito">
            ${option("OK", d.esito)}
            ${option("KO", d.esito)}
            ${option("Da verificare", d.esito)}
          </select>
        </div>
        <div class="field" data-label="Azioni correttive / Note">
          <textarea placeholder="Azioni correttive, note, follow-up...">${escapeHtml(d.note)}</textarea>
        </div>
        <div class="field cell-actions no-print" data-label="Azioni">
          <button class="btn-mini" type="button" onclick="deleteRow(this)">Elimina</button>
        </div>
      </div>
    `;
  }

  function option(label, current){
    const sel = (label === current) ? "selected" : "";
    return `<option ${sel}>${label}</option>`;
  }

  function escapeHtml(str){
    return (str || "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
  }

  function getTableData(){
    const rows = Array.from(document.querySelectorAll("#registroRows .registro-row"));
    return rows.map(r => {
      const date = r.querySelector('input[type="date"]').value || "";
      const area = r.querySelector("select.area")?.value || "";
      const esito = r.querySelector("select.esito")?.value || "";
      const texts = r.querySelectorAll("textarea");
      const attivita = texts[0]?.value || "";
      const note = texts[1]?.value || "";
      return {date, area, attivita, esito, note};
    });
  }

  function renderTable(data){
    const host = document.querySelector("#registroRows");
    host.innerHTML = (data && data.length) ? data.map(rowTemplate).join("") : rowTemplate();
    syncEsitoClasses();
  }

  function addRow(){
    const host = document.querySelector("#registroRows");
    host.insertAdjacentHTML("beforeend", rowTemplate());
    syncEsitoClasses();
  }

  function deleteRow(btn){
    const row = btn.closest(".registro-row");
    if(row) row.remove();
    // non salvo in automatico: scelta voluta (evita salvataggi involontari). Usa "Salva".
  }

  function syncEsitoClasses(){
    document.querySelectorAll("select.esito").forEach(s => {
      s.classList.remove("ok","warn","ko");
      if(s.value === "OK") s.classList.add("ok");
      else if(s.value === "KO") s.classList.add("ko");
      else s.classList.add("warn");
    });
  }

  function saveRegistro(){
    const data = getTableData();
    localStorage.setItem(REG_KEY, JSON.stringify(data));
    alert("Registro salvato nel browser.");
  }

  function loadRegistro(){
    try{
      const raw = localStorage.getItem(REG_KEY);
      if(!raw){
        alert("Nessun registro salvato trovato.");
        return;
      }
      const data = JSON.parse(raw);
      renderTable(Array.isArray(data) ? data : []);
      alert("Registro caricato.");
    }catch(e){
      alert("Errore nel caricamento del registro.");
    }
  }

  function exportJSON(){
    const data = getTableData();
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "registro-controlli-preposto.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function clearRegistro(){
    if(!confirm("Vuoi svuotare il registro?")) return;
    renderTable([]);
    localStorage.removeItem(REG_KEY);
  }

  // Init
  loadChecklist();
  (function initRegistro(){
    // Carico se esiste, altrimenti riga vuota
    try{
      const raw = localStorage.getItem(REG_KEY);
      if(raw){
        const data = JSON.parse(raw);
        renderTable(Array.isArray(data) ? data : []);
      }else{
        renderTable([]);
      }
    }catch(e){
      renderTable([]);
    }
  })();
</script>
</body>
</html>
